{% extends "base.html" %}

{% block title %}About Us{% endblock %}

{% block head %}
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
	#map_canvas { height: 50%; width: 50%; }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiX6DQhbFwmwZ6SFMjCOpNhPjP--9O-o4&sensor=false">
    </script>
    <script type="text/javascript">
	var map;
	var directionsPanel;

	function initialize() {
	    var mapOptions = {
		center: new google.maps.LatLng(34.1389397, -117.8654231),
		zoom: 9,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	    };

	    map = new google.maps.Map(document.getElementById("map_canvas"),
		mapOptions);
	    directionsPanel = document.getElementById("directionsPanel");
	}
     
	
	function renderDirections(originAddress, destinationAddress, stops){
	    var directionsService = new google.maps.DirectionsService();

	    var renderOptions = { draggable: true };
	    var directionDisplay = new google.maps.DirectionsRenderer(renderOptions);
	    
	    //set the directions display service to the map
	    directionDisplay.setMap(map);
	    //set the directions display panel
	    //panel is usually just and empty div.  
	    //This is where the turn by turn directions appear.
	    directionDisplay.setPanel(directionsPanel); 
	    
	    //build the waypoints
	    //free api allows a max of 9 total stops including the start and end address
	    //premier allows a total of 25 stops. 
	    var waypoints = [];
	    for (var i = 0; i < stops.length; i++) {
		var address = stops[i];
		if (address !== "") {
		    waypoints.push({
			location: address,
			stopover: true
		    });
		}
	    }
	    
	    //build directions request
	    var request = {
			origin: originAddress,
			destination: destinationAddress,
			waypoints: waypoints, //an array of waypoints
			optimizeWaypoints: false, //set to true if you want google to determine the shortest route or false to use the order specified.
			travelMode: google.maps.DirectionsTravelMode.DRIVING
		    };
	    
	    //get the route from the directions service
	    directionsService.route(request, function (response, status) {
		if (status == google.maps.DirectionsStatus.OK) {
		    directionDisplay.setDirections(response);
		}
		else {
		    console.log("Error calculating directions");
		}
	    });
	}
</script>

{% endblock %}

{% block content %}

<div class="container-fluid"> 
    <div class="row-fluid">
	<div class="span6">
	    <div>
		<h1>Search</h1>
	    </div>
	</div>
    </div>
    
    <div class="row-fluid">
	<div class="span9" id="wines">
	    <p class="span7 pull-left">Enter search characteristics to find your ideal wine.
	    For numeric values enter a number, such as 14.0, or a range,
	    such as 13.0-15.4</p></br></br><br/>
	    <input class="btn btn-success pull-left" id="submit_button" value="Find My Wine" />
	    <br/>
	    <br/>
	    <button class="btn btn-info wine-add pull-left">Add Wine</button>
	    <br/>
	    <br/>
	    <div class="wine">
		<h4 class="pull-left">Select your characteristics for this wine&nbsp;</h4>
		<button class="btn btn-primary add pull-left">Add Option</button>
		<br/>
		<br/>
		<form name="input-whole" class="navbar-form pull-left">
		    <p class="input-line">
			<select> 
			    <option name="">(Select Option)</option>
			    <option name="color">Color</option>
			    <option name="country">Country</option>
			    <option name="percent_new_oak">Percent New Oak</option>
			    <option name="percentage_alcohol">Percent Alcohol</option>
			    <option name="region">Region</option>
			    <option name="wine_type">Type</option>
			    <option name="wine_producer">Wine Producer</option>
			    <option name="vineyard">Vineyard</option>
			    <option name="vintage">Vintage</option>
			    <option name="wine_sub_region">Wine Subregion</option>
			</select>
			<input class="input-text" type="text">
			<button class="btn btn-small btn-danger remove">Remove</button>
		    </p>
		</form>
	    <br/>
	    <br/>
	    </div>
	</div>

	<div class="span6 pull-right" style="position: absolute; top: 100px; right: 100px;">
	    <div id="map_canvas" style="width: 400px; height: 300px"></div>
	    <div id="directionsPanel" style="width: 400px;"></div>
	</div>
    </div>

</div>

<script type="text/javascript">
    $(document).ready(function(){
	initialize();
	renderDirections("55 Ridgewood Road, Ithaca NY, 14850",
			 "Duffield Hall, Ithaca NY, 14850",
			    ["Collegetown Bagels, Ithaca NY 14850",
			    "Johnson Museum, Ithaca NY, 14850"]);
    });
    
    $(".add").click(function() {
	firstP = $(this).siblings("form").children(":first");
	console.log(firstP);
	newP = firstP.clone(true)
	newP.insertBefore(firstP);
	return false;
    });

    $(".wine-add").click(function() {
	$("#wines > .wine:first").clone(true).insertBefore("#wines > .wine:first");
	return false;
    });

    $(".remove").click(function() {
    	removeOption($(this));
    });
    
    function removeOption(obj){
	if (obj.parent().siblings().size() > 1){
	    obj.parent().remove();
	}
    }
</script>
{% endblock %}
